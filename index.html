<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blokie - Hub</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root { --bg: #0c0c0c; --nav: #1b1b1b; --panel: #141414; --text: #fff; --sub: #b0b0b0; --green: #2ecc71; --blue: #3498db; --border: #333; }
        body, html { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; }
        
        /* Modern Nav */
        nav { background: var(--nav); height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 50px; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
        .nav-tabs { display: flex; gap: 20px; }
        .tab { color: var(--sub); cursor: pointer; font-weight: 500; font-size: 0.95rem; padding: 10px; border-radius: 5px; transition: 0.2s; }
        .tab:hover, .tab.active { color: #fff; background: #252525; }

        /* Game Menu Layout */
        .game-header { width: 100%; height: 250px; background: linear-gradient(to bottom, rgba(0,0,0,0.4), var(--bg)), url('https://placehold.co/1200x400/222/444'); background-size: cover; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .play-btn-large { background: var(--green); width: 400px; height: 50px; border: none; border-radius: 8px; color: white; font-size: 1.5rem; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .play-btn-large:hover { transform: scale(1.02); filter: brightness(1.1); }

        .game-container { max-width: 1200px; margin: 20px auto; display: grid; grid-template-columns: 1.2fr 1fr; gap: 20px; padding: 0 20px; }
        .info-panel { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 25px; line-height: 1.6; }
        .screenshot-panel { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; position: relative; }
        .screenshot-img { width: 100%; height: 350px; object-fit: cover; }

        .view { display: none; }
        .view.active { display: block; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; padding: 20px; }
    </style>
</head>
<body onload="initHub()">

    <nav>
        <div class="nav-tabs">
            <b style="color:var(--green); font-size: 1.4rem; margin-right: 20px;">BLOKIE</b>
            <div class="tab active" onclick="showView('worlds')">Games</div>
            <div class="tab" onclick="showView('players')">Players</div>
            <div class="tab" onclick="window.open('studio.html', '_blank')">Studio</div>
        </div>
    </nav>

    <div id="worlds" class="view active">
        <h2 style="padding: 20px 50px;">Featured Games</h2>
        <div class="grid" id="games-list"></div>
    </div>

    <div id="game-menu" class="view">
        <div class="game-header">
            <button class="play-btn-large" onclick="launchGame()"><i class="fas fa-play"></i></button>
        </div>
        <div class="game-container">
            <div class="info-panel">
                <h2 id="menu-title">Game Title</h2>
                <p id="menu-desc" style="color:var(--sub)">Quickly, run around in circles! Your life depends on it!</p>
                <hr style="border:0; border-top:1px solid #333; margin: 20px 0;">
                <div style="color:var(--sub); font-size: 0.9rem;">
                    <b>Maps:</b> Happy Home, Sunny Ranch, Sky Tower
                </div>
            </div>
            <div class="screenshot-panel">
                <img id="menu-thumb" class="screenshot-img" src="">
            </div>
        </div>
        <center><button onclick="showView('worlds')" style="background:none; border:none; color:var(--sub); cursor:pointer;">Back to Discovery</button></center>
    </div>

    <div id="engine-view" class="view">
        <div id="canvas-container"></div>
        <button onclick="location.reload()" style="position:absolute; top:20px; left:20px; z-index:100; background:rgba(0,0,0,0.7); color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer;">Leave</button>
    </div>

    <script>
        let selectedGame = null;

        function initHub() {
            const list = document.getElementById('games-list');
            const games = JSON.parse(localStorage.getItem('blokie_games')) || [];
            list.innerHTML = "";
            games.forEach((g, i) => {
                const d = document.createElement('div');
                d.className = "info-panel";
                d.style.cursor = "pointer";
                d.innerHTML = `<img src="${g.thumb}" style="width:100%; height:150px; border-radius:8px; object-fit:cover;"><h3>${g.name}</h3>`;
                d.onclick = () => openGameMenu(g);
                list.appendChild(d);
            });
        }

        function showView(id) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function openGameMenu(game) {
            selectedGame = game;
            document.getElementById('menu-title').innerText = game.name;
            document.getElementById('menu-thumb').src = game.thumb;
            showView('game-view'); // This refers to the layout view
            document.getElementById('game-menu').classList.add('active');
        }

        function launchGame() {
            showView('engine-view');
            const scene = new THREE.Scene(); scene.background = new THREE.Color(0x87ceeb);
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({antialias:true});
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            scene.add(new THREE.AmbientLight(0xffffff, 0.8));
            selectedGame.blocks.forEach(b => {
                const m = new THREE.Mesh(new THREE.BoxGeometry(1,1,1), new THREE.MeshStandardMaterial({color:b.col}));
                m.position.set(b.pos.x, b.pos.y, b.pos.z); scene.add(m);
            });
            
            camera.position.set(0, 10, 20); camera.lookAt(0,0,0);
            function anim() { requestAnimationFrame(anim); renderer.render(scene, camera); }
            anim();
        }
    </script>
</body>
</html>
