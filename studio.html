<!DOCTYPE html>
<html>
<head><title>Blokie Studio</title><script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script></head>
<body style="margin:0; background:#111; color:white; font-family:sans-serif; display:flex;">
    <div style="width:300px; background:#1a1a1a; padding:20px; border-right:1px solid #333; height:100vh; box-sizing:border-box;">
        <h2>Studio</h2>
        <input type="color" id="blockCol" value="#ffffff" style="width:100%; height:40px; margin-bottom:10px;">
        <input type="text" id="gName" placeholder="World Name" style="width:100%; padding:10px; margin-bottom:10px; background:#000; color:white; border:1px solid #444;">
        <p>Thumbnail Image:</p>
        <input type="file" id="thumbInput" accept="image/*" style="width:100%; margin-bottom:20px;">
        <button onclick="save()" style="width:100%; padding:15px; background:#2ecc71; border:none; color:white; font-weight:bold; cursor:pointer;">PUBLISH</button>
    </div>
    <div id="v" style="flex-grow:1;"></div>
    <script>
        let s = new THREE.Scene(), c = new THREE.PerspectiveCamera(75, (window.innerWidth-300)/window.innerHeight, 0.1, 1000), r = new THREE.WebGLRenderer();
        r.setSize(window.innerWidth-300, window.innerHeight); document.getElementById('v').appendChild(r.domElement);
        s.add(new THREE.GridHelper(40,40), new THREE.AmbientLight(0xffffff,0.8)); c.position.set(10,10,10); c.lookAt(0,0,0);
        let blocks = [], thumbBase64 = "", ray = new THREE.Raycaster(), m = new THREE.Vector2();

        document.getElementById('thumbInput').onchange = e => {
            const reader = new FileReader();
            reader.onload = () => thumbBase64 = reader.result;
            reader.readAsDataURL(e.target.files[0]);
        };

        window.addEventListener('mousedown', e => {
            if(e.clientX < 300) return;
            m.x = ((e.clientX-300)/(window.innerWidth-300))*2-1; m.y = -(e.clientY/window.innerHeight)*2+1;
            ray.setFromCamera(m, c); const hits = ray.intersectObjects(s.children);
            if(hits.length > 0) {
                const b = new THREE.Mesh(new THREE.BoxGeometry(1,1,1), new THREE.MeshStandardMaterial({color:document.getElementById('blockCol').value}));
                b.position.copy(hits[0].point).add(hits[0].face.normal).floor().addScalar(0.5);
                s.add(b); blocks.push(b);
            }
        });

        function save() {
            const games = JSON.parse(localStorage.getItem('blokie_published_games')) || [];
            games.push({ name: document.getElementById('gName').value || "New World", thumb: thumbBase64, blocks: blocks.map(b => ({pos: b.position, col: b.material.color.getHex()})) });
            localStorage.setItem('blokie_published_games', JSON.stringify(games)); alert("Published!");
        }
        function anim() { requestAnimationFrame(anim); r.render(s, c); } anim();
    </script>
</body>
</html>
</html>

