<!DOCTYPE html>
<html>
<head><title>BlokStudio</title><script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script></head>
<body style="margin:0; background:#111; color:white; font-family:sans-serif; display:flex; height:100vh; overflow:hidden;">
    <div style="width:250px; background:#1e1e1e; padding:20px; border-right:1px solid #333;">
        <h2>STUDIO</h2>
        <input type="color" id="col" value="#ffffff" style="width:100%; height:40px; margin-bottom:10px;">
        <button onclick="publish()" style="width:100%; padding:10px; background:#2ecc71; border:none; color:white; font-weight:bold; cursor:pointer;">PUBLISH</button>
    </div>
    <div id="v" style="flex-grow:1;"></div>
    <script>
        let s = new THREE.Scene(), c = new THREE.PerspectiveCamera(75, (window.innerWidth-250)/window.innerHeight, 0.1, 1000), r = new THREE.WebGLRenderer();
        r.setSize(window.innerWidth-250, window.innerHeight); document.getElementById('v').appendChild(r.domElement);
        s.add(new THREE.GridHelper(40,40,0x444444), new THREE.AmbientLight(0xffffff,0.8)); c.position.set(10,10,10); c.lookAt(0,0,0);
        let blocks = [], ray = new THREE.Raycaster(), m = new THREE.Vector2();
        window.addEventListener('mousedown', e => {
            m.x = ((e.clientX-250)/(window.innerWidth-250))*2-1; m.y = -(e.clientY/window.innerHeight)*2+1;
            ray.setFromCamera(m, c); const hits = ray.intersectObjects(s.children);
            if(hits.length > 0) {
                const b = new THREE.Mesh(new THREE.BoxGeometry(1,1,1), new THREE.MeshStandardMaterial({color:document.getElementById('col').value}));
                b.position.copy(hits[0].point).add(hits[0].face.normal).floor().addScalar(0.5); s.add(b); blocks.push(b);
            }
        });
        function publish() {
            const name = prompt("Game Name?"), games = JSON.parse(localStorage.getItem('blokie_published_games')) || [];
            games.push({name, thumb: "https://placehold.co/400x300?text="+name, blocks: blocks.map(b => ({pos:b.position, col:b.material.color.getHex()}))});
            localStorage.setItem('blokie_published_games', JSON.stringify(games)); alert("Published!"); window.close();
        }
        function anim() { requestAnimationFrame(anim); r.render(s, c); } anim();
    </script>
</body>
</html>
